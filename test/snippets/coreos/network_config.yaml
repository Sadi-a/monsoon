variant: flatcar
version: 1.0.0
systemd:
  units:
  #tbf : etc-nsswitch-conf.mount: Where= setting doesn't match unit name. Refusing.
  - name: etc-nssswitch.conf.mount
    enabled: true
    contents: |
      [Mount]
      What=/etc/nsswitch.conf.new
      Where=/etc/nsswitch.conf
      Type=none
      Options=bind
      [Install]
      WantedBy=local-fs.target
storage:
  directories:
    - path: /etc/systemd/resolved.conf.d
      mode: 0644
  files:
    - path: /etc/sysctl.d/flannel.conf
      # Required to run flannel
      mode: 0644
      contents:
        inline: |
          net.bridge.bridge-nf-call-iptables=1
          net.bridge.bridge-nf-call-ip6tables=1
          net.ipv4.ip_forward=1
          net.ipv4.conf.all.arp_filter=1
    - path: /etc/systemd/network/zy-dhcp.network
      mode: 0644
      contents:
        inline: |
          [Network]
          DHCP=ipv4
          LinkLocalAddressing=no
          IPv6AcceptRA=no
          # For changing Domains use /etc/systemd/resolved.conf.d/zy-aristanetworks.conf
          Domains=sjc.aristanetworks.com aristanetworks.com
          NTP=time1.google.com
          NTP=time2.google.com
          NTP=time3.google.com
          [DHCP]
          UseNTP=false
    - path: /etc/systemd/network/etc/systemd/network/70-cni.network
      mode: 0644
      contents:
        inline: |
          [Match]
          Name=cni*
          [Link]
          Unmanaged=yes
    - path: /etc/systemd/resolved.conf.d/zy-aristanetworks.conf
      mode: 0644
      append:
      # NOTE: do not put the abusive search string we put everywhere. This just
      # causes baffling resolution errors in user applications.
      - inline: |
          [Resolve]
          Domains=aristanetworks.com sjc.aristanetworks.com
    - path: /etc/nsswitch.conf.new
      contents:
        inline: |
          passwd:      files usrfiles systemd
          shadow:      files usrfiles
          group:       files usrfiles systemd

          hosts:       files usrfiles resolve myhostname dns
          networks:    files usrfiles dns

          services:    files usrfiles
          protocols:   files usrfiles
          rpc:         files usrfiles

          ethers:      files
          netmasks:    files
          netgroup:    files
          bootparams:  files
          automount:   files
          aliases:     files
